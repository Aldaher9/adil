<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุตุฉ ุงููุงุฆุฏ - ูุธุงู ุงูุฅุฏุงุฑุฉ ุงููุชูุงูู</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body style="display: none;">

<!-- Firebase Login Screen ุณูุชู ุฅุฏุฑุงุฌู ุจูุงุณุทุฉ firebase-ui.js -->

<!-- Header -->
<div class="header">
    <div class="user-welcome" id="welcomeMsg">๐ค ูุฑุญุจ ุจุงููุงุฆุฏ</div>
    <div class="header-top">
        <h1>ููุตุฉ ุงููุงุฆุฏ โก</h1>
        <div class="header-actions">
            <button class="header-btn" onclick="openModal()">โ๏ธ ุถุจุท</button>
            <button class="header-btn logout-btn" onclick="handleLogoutFirebase()">๐ช ุฎุฑูุฌ</button>
        </div>
    </div>
</div>

<!-- Dashboard View -->
<div id="view-dashboard" class="container active">
    <h3 style="margin-top:0;">๐ ููุญุฉ ุงููุนูููุงุช</h3>
    
    <!-- Sync Button -->
    <div style="margin-bottom:20px;">
        <button onclick="manualSync()" class="btn-primary" style="width:100%; padding:12px;">
            ๐ ูุฒุงููุฉ ุงูุจูุงูุงุช ูุน ุงูุณุญุงุจุฉ
        </button>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">๐ฅ</div>
            <div class="stat-value" id="statTeachers">0</div>
            <div class="stat-label">ุนุฏุฏ ุงููุนูููู</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">๐</div>
            <div class="stat-value" id="statClasses">0</div>
            <div class="stat-label">ุนุฏุฏ ุงููุตูู</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">๐๏ธ</div>
            <div class="stat-value" id="statVisits">0</div>
            <div class="stat-label">ุงูุฒูุงุฑุงุช ูุฐุง ุงูุฃุณุจูุน</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">๐</div>
            <div class="stat-value" id="statTasks">0</div>
            <div class="stat-label">ุงูููุงู ุงููุดุทุฉ</div>
        </div>
    </div>

    <div class="card">
        <h4>๐ ุฅุญุตุงุฆูุงุช ุงูุฒูุงุฑุงุช ุงูุฅุดุฑุงููุฉ</h4>
        <canvas id="visitsChart"></canvas>
    </div>

    <div class="card">
        <h4>โฐ ุงูุญุตุฉ ุงูุญุงููุฉ</h4>
        <div class="status-card">
            <div>
                <div id="dashDate">--:--</div>
                <div id="dashPeriod" style="font-weight:800; font-size:1.1rem; color: #0f172a;">ุฌุงุฑู ุงููุฒุงููุฉ..</div>
            </div>
            <div id="dashSimBadge" style="display:none; background:#fee2e2; color:#ef4444; padding:5px 10px; border-radius:10px; font-weight:bold;">ูุถุน ุงููุญุงูุงุฉ</div>
        </div>
    </div>
</div>

<!-- Schedule View -->
<div id="view-schedule" class="container">
    <div class="status-card">
        <div>
            <div id="infoDate">--:--</div>
            <div id="infoPeriod" style="font-weight:800; font-size:1.1rem; color: #0f172a;">ุฌุงุฑู ุงููุฒุงููุฉ..</div>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
            <div id="simBadge" style="display:none; background:#fee2e2; color:#ef4444; padding:5px 10px; border-radius:10px; font-weight:bold;">ูุถุน ุงููุญุงูุงุฉ</div>
            <button onclick="exitSimMode()" id="exitSimBtn" style="display:none; padding:5px 10px; background:#10b981; color:white; border:none; border-radius:10px; cursor:pointer; font-size:12px; font-weight:bold;">โฉ๏ธ ุงูููุช ุงูุญูููู</button>
        </div>
    </div>
    <div id="lessons-list"></div>
</div>

<!-- Staff View -->
<div id="view-staff" class="container">
    <input type="text" id="searchInput" placeholder="๐ ุงุจุญุซ ุนู ูุนูู..." onkeyup="filterStaff()" style="width:100%; padding:15px; border-radius:12px; border:2px solid #ddd; margin-bottom:15px;">
    <div id="staff-list"></div>
</div>

<!-- Visits View -->
<div id="view-visits" class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin:0;">๐๏ธ ุงูุฒูุงุฑุงุช ุงูุฅุดุฑุงููุฉ</h3>
        <button onclick="openVisitModal()" class="btn-primary">+ ุฒูุงุฑุฉ ุฌุฏูุฏุฉ</button>
    </div>
    
    <div class="filter-section">
        <select id="visitFilter" onchange="filterVisits()" class="filter-select">
            <option value="all">ุฌููุน ุงูุฒูุงุฑุงุช</option>
            <option value="today">ุงูููู</option>
            <option value="week">ูุฐุง ุงูุฃุณุจูุน</option>
            <option value="month">ูุฐุง ุงูุดูุฑ</option>
        </select>
    </div>
    
    <div id="visits-list"></div>
</div>

<!-- Reports View -->
<div id="view-reports" class="container">
    <h3 style="margin-top:0;">๐ ุงูุชูุงุฑูุฑ</h3>
    
    <div class="report-options">
        <div class="card report-card" onclick="generateTeacherReport()">
            <div class="report-icon">๐ฅ</div>
            <h4>ุชูุฑูุฑ ุงููุนูููู</h4>
            <p>ุชูุฑูุฑ ุดุงูู ุนู ุฌููุน ุงููุนูููู ูุฃุฑูุงููู</p>
        </div>
        
        <div class="card report-card" onclick="generateVisitsReport()">
            <div class="report-icon">๐๏ธ</div>
            <h4>ุชูุฑูุฑ ุงูุฒูุงุฑุงุช</h4>
            <p>ููุฎุต ุงูุฒูุงุฑุงุช ุงูุฅุดุฑุงููุฉ ูุงูุชููููุงุช</p>
        </div>
        
        <div class="card report-card" onclick="generateScheduleReport()">
            <div class="report-icon">๐</div>
            <h4>ุชูุฑูุฑ ุงูุฌุฏูู</h4>
            <p>ุชุญููู ุชูุฒูุน ุงูุญุตุต ูุงูููุงุฏ</p>
        </div>
        
        <div class="card report-card" onclick="generateDetailedVisitReport()">
            <div class="report-icon">๐</div>
            <h4>ุชูุฑูุฑ ุงูุฒูุงุฑุงุช ุงูุชูุตููู</h4>
            <p>ุชูุฑูุฑ ููุตู ุจูุงุกู ุนูู ุงูุงุณุชูุงุฑุฉ ุงููุนุชูุฏุฉ</p>
        </div>
    </div>
</div>

<!-- Agenda View -->
<div id="view-agenda" class="container">
    <h3 style="margin-top:0;">๐ ุฃุฌูุฏุฉ ุงูููุงู</h3>
    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <input type="text" id="taskInput" style="flex:1; padding:12px; border-radius:12px; border:2px solid #ddd;" placeholder="ุงูุชุจ ูููุฉ ุฌุฏูุฏุฉ...">
        <button onclick="addTask()" class="btn-primary">ุฅุถุงูุฉ</button>
    </div>
    <div id="tasks-list"></div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <button class="nav-item active" onclick="switchTab('view-dashboard', this)">
        <span>๐</span> ุงูุฑุฆูุณูุฉ
    </button>
    <button class="nav-item" onclick="switchTab('view-schedule', this)">
        <span>๐</span> ุงูุญุตุต
    </button>
    <button class="nav-item" onclick="switchTab('view-staff', this)">
        <span>๐ฅ</span> ุงููุนูููู
    </button>
    <button class="nav-item" onclick="switchTab('view-visits', this)">
        <span>๐๏ธ</span> ุงูุฒูุงุฑุงุช
    </button>
    <button class="nav-item" onclick="switchTab('view-reports', this)">
        <span>๐</span> ุงูุชูุงุฑูุฑ
    </button>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h3>โ๏ธ ุฅุนุฏุงุฏุงุช ุงูููุตุฉ</h3>
        
        <p style="font-size:12px; font-weight:bold;">1. ููู ุงูุฌุฏูู (XML)</p>
        <input type="file" id="xmlFile" accept=".xml" onchange="handleXML(this)" style="width:100%; margin-bottom:15px;">
        
        <p style="font-size:12px; font-weight:bold;">2. ุจูุงูุงุช ุงููุนูููู (Excel)</p>
        <div class="grid-2" style="margin-bottom:15px;">
            <button onclick="exportToExcel()" style="padding:10px; background:#10b981; color:white; border:none; border-radius:10px;">๐ฅ ุชุตุฏูุฑ</button>
            <button onclick="document.getElementById('excelFile').click()" style="padding:10px; background:#3b82f6; color:white; border:none; border-radius:10px;">๐ค ุงุณุชูุฑุงุฏ</button>
            <input type="file" id="excelFile" accept=".xlsx, .xls" style="display:none" onchange="importFromExcel(this)">
        </div>
        
        <p style="font-size:12px; font-weight:bold;">3. ุงุณุชูุงุฑุฉ ุงูุฒูุงุฑุงุช (JSON)</p>
        <div style="margin-bottom:15px;">
            <button onclick="document.getElementById('jsonFile').click()" style="width:100%; padding:10px; background:#8b5cf6; color:white; border:none; border-radius:10px;">๐ค ุงุณุชูุฑุงุฏ ุงุณุชูุงุฑุฉ ุงูุชูููู</button>
            <input type="file" id="jsonFile" accept=".json" style="display:none" onchange="importVisitCriteria(this)">
        </div>
        
        <p style="font-size:12px; font-weight:bold;">4. ูุญุงูุงุฉ ุงูุญุตุต</p>
        <div style="margin-bottom:15px;">
            <button onclick="startRandomSimulation()" style="width:100%; padding:10px; background:#f59e0b; color:white; border:none; border-radius:10px; font-weight:bold;">๐ฒ ูุญุงูุงุฉ ุญุตุฉ ุนุดูุงุฆูุฉ</button>
        </div>
        
        <button onclick="closeModal()" style="width:100%; margin-top:20px; padding:12px; background:#94a3b8; color:white; border:none; border-radius:10px;">ุฅุบูุงู</button>
    </div>
</div>

<!-- Visit Modal -->
<div id="visitModal" class="modal">
    <div class="modal-content" style="max-width:600px; max-height:85vh; overflow-y:auto;">
        <h3>๐๏ธ ุฒูุงุฑุฉ ุฅุดุฑุงููุฉ ุฌุฏูุฏุฉ</h3>
        
        <div class="form-group">
            <label>ุงุณู ุงููุนูู *</label>
            <select id="visitTeacher" class="form-control"></select>
        </div>
        
        <div class="form-group">
            <label>ุงูุชุงุฑูุฎ ูุงูููุช *</label>
            <input type="datetime-local" id="visitDate" class="form-control">
        </div>
        
        <div class="form-group">
            <label>ุงููุตู</label>
            <input type="text" id="visitClass" class="form-control" placeholder="ูุซุงู: 3/1">
        </div>
        
        <div class="form-group">
            <label>ุงููุงุฏุฉ</label>
            <input type="text" id="visitSubject" class="form-control" placeholder="ูุซุงู: ุงูุฑูุงุถูุงุช">
        </div>
        
        <div id="criteriaContainer"></div>
        
        <div class="form-group">
            <label>ููุงุญุธุงุช ุฅุถุงููุฉ</label>
            <textarea id="visitNotes" class="form-control" rows="3" placeholder="ุฃู ููุงุญุธุงุช ุฃุฎุฑู..."></textarea>
        </div>
        
        <div class="grid-2" style="margin-top:20px;">
            <button onclick="saveVisit()" class="btn-primary">๐พ ุญูุธ ุงูุฒูุงุฑุฉ</button>
            <button onclick="closeVisitModal()" style="padding:12px; background:#94a3b8; color:white; border:none; border-radius:10px;">ุฅูุบุงุก</button>
        </div>
    </div>
</div>

<!-- Scripts - ุชุญููู Firebase ูู ES Modules -->
<script type="module">
    // ุชุญููู Firebase ุฃููุงู
    import './firebase-config.js';
    import './firebase-service.js';
</script>

<!-- ุชุญููู ุจุงูู ุงูุณูุฑูุจุชุงุช -->
<script src="firebase-ui.js"></script>
<script src="firebase-helpers.js"></script>
<script src="script.js"></script>

</body>
</html>
