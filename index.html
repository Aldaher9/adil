<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø§Ø¦Ø¯ - Ù†Ø³Ø®Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #0f172a; --accent: #f59e0b; --bg: #f1f5f9; }
        * { font-family: 'Tajawal', sans-serif; box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); padding-bottom: 70px; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© */
        #login-screen { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; align-items: center; justify-content: center; text-align: center; }
        .login-card { padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 400px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); color: white; padding: 20px; border-radius: 0 0 20px 20px; }
        .container { padding: 15px; display: none; }
        .active { display: block; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #ddd; height: 60px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; cursor: pointer; color: #64748b; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <h1>Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø§Ø¦Ø¯ âš¡</h1>
        <p style="margin: 15px 0; color: #64748b;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ Ø§Ø¶ØºØ· Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</p>
        <button onclick="unlockApp()" class="btn" style="background: #10b981;">Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</button>
        <p style="margin-top: 10px; font-size: 11px; color: #94a3b8;">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
    </div>
</div>

<div id="app" style="display:none;">
    <div class="header">
        <h2>Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø§Ø¦Ø¯</h2>
        <div id="userLabel" style="font-size: 12px; opacity: 0.8;">ğŸ‘¤ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
    </div>

    <div id="tab1" class="container active">
        <h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        <div class="card" style="margin-top:15px;">
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: <b id="tCount">0</b></p>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: <b id="vCount">0</b></p>
        </div>
        <button onclick="openSettings()" class="btn">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

    <div id="tab2" class="container">
        <h3>ğŸ‘ï¸ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ©</h3>
        <button onclick="addVisit()" class="btn" style="background:var(--accent);">+ Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø©</button>
        <div id="visitsList" style="margin-top:15px;"></div>
    </div>

    <div id="tab3" class="container">
        <h3>ğŸ‘¥ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h3>
        <div id="staffList" style="margin-top:15px;"></div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="showTab('tab1', this)"><span>ğŸ“Š</span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="nav-item" onclick="showTab('tab2', this)"><span>ğŸ‘ï¸</span>Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
        <div class="nav-item" onclick="showTab('tab3', this)"><span>ğŸ‘¥</span>Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</div>
    </nav>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let state = {
        teachers: {},
        visits: []
    };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    function init() {
        const saved = localStorage.getItem('school_data');
        if (saved) {
            state = JSON.parse(saved);
            render();
        }
    }

    function unlockApp() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        init();
    }

    function showTab(id, el) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    function render() {
        document.getElementById('tCount').innerText = Object.keys(state.teachers).length;
        document.getElementById('vCount').innerText = state.visits.length;

        // Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
        const sList = document.getElementById('staffList');
        sList.innerHTML = Object.values(state.teachers).map(t => `<div class="card">${t}</div>`).join('') 
                         || '<p style="text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ù„Ù…ÙŠÙ†. Ø§Ø³ØªÙˆØ±Ø¯ Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</p>';

        // Ø±Ù†Ø¯Ø± Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
        const vList = document.getElementById('visitsList');
        vList.innerHTML = state.visits.map(v => `
            <div class="card">
                <b>${v.teacher}</b><br>
                <small>${v.date}</small><br>
                <p>${v.notes}</p>
            </div>
        `).join('');
    }

    function addVisit() {
        const t = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:");
        const n = prompt("Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:");
        if(t && n) {
            state.visits.unshift({ teacher: t, notes: n, date: new Date().toLocaleDateString() });
            save();
        }
    }

    function openSettings() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = e => {
            const reader = new FileReader();
            reader.onload = f => {
                const data = JSON.parse(f.target.result);
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø§Ø¯Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
                if(data.teachers) state.teachers = data.teachers;
                // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø±Ø§Øª
                if(Array.isArray(data)) state.visits = [...data, ...state.visits];
                save();
                alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
            };
            reader.readAsText(e.target.files[0]);
        };
        input.click();
    }

    function save() {
        localStorage.setItem('school_data', JSON.stringify(state));
        render();
    }
</script>
</body>
</html>
