<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مدير المدرسة الذكي</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,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">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .view {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay {
            animation: fadeIn 0.2s ease-out;
        }
        .modal-content {
            animation: scaleIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .pb-safe { padding-bottom: calc(1rem + env(safe-area-inset-bottom)); }
        .h-nav { height: calc(4rem + env(safe-area-inset-bottom)); }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        .dir-ltr { direction: ltr; }
    </style>
<script type="importmap">
{
  "imports": {
    "rxjs": "https://esm.sh/rxjs@^7.8.2?conditions=es2015",
    "rxjs/operators": "https://esm.sh/rxjs@^7.8.2/operators?conditions=es2015",
    "rxjs/ajax": "https://esm.sh/rxjs@^7.8.2/ajax?conditions=es2015",
    "rxjs/webSocket": "https://esm.sh/rxjs@^7.8.2/webSocket?conditions=es2015",
    "rxjs/testing": "https://esm.sh/rxjs@^7.8.2/testing?conditions=es2015",
    "rxjs/fetch": "https://esm.sh/rxjs@^7.8.2/fetch?conditions=es2015",
    "@angular/core": "https://esm.sh/@angular/core@^21.0.8?external=rxjs",
    "@angular/common": "https://esm.sh/@angular/common@^21.0.8?external=rxjs",
    "@angular/forms": "https://esm.sh/@angular/forms@^21.0.8?external=rxjs"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Login View -->
    <div id="loginView" class="view active min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-sky-400 to-blue-600 p-4">
        <div class="w-full max-w-sm text-center">
            <div class="bg-white/20 backdrop-blur-lg p-5 rounded-3xl inline-block shadow-lg mb-6 border border-white/30">
                 <img src="data:image/png;base64,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" alt="شعار مدير المدرسة" class="w-20 h-20 rounded-2xl">
            </div>
            <h1 class="text-3xl font-extrabold text-white mb-2">مدير المدرسة الذكي</h1>
            <p class="text-white/80 mb-8">نظام إدارة مدرسية لمتابعة الحصص والمعلمين.</p>
             <div class="bg-white p-6 rounded-2xl shadow-lg space-y-3">
                <button id="googleLoginBtn" class="w-full flex items-center justify-center gap-3 bg-white hover:bg-slate-50 text-slate-700 font-bold py-3 rounded-lg transition shadow-md border border-slate-200">
                    <img src="https://www.google.com/favicon.ico" alt="Google icon" class="w-5 h-5">
                    <span>تسجيل الدخول باستخدام جوجل</span>
                </button>
                <button id="guestLoginBtn" class="w-full flex items-center justify-center gap-3 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition shadow-md">
                    <i class="fas fa-user-secret text-slate-300"></i>
                    <span>المتابعة كضيف</span>
                </button>
            </div>
            <p class="text-xs text-white/50 mt-4">الإصدار 3.2.0</p>
        </div>
    </div>

    <!-- Main Application Wrapper -->
    <div id="appWrapper" class="hidden">
        <!-- Header -->
        <header class="bg-gradient-to-r from-sky-500 to-blue-600 text-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <h1 class="text-lg font-bold flex items-center gap-2">
                    <i class="fas fa-chart-line text-yellow-300 text-xl"></i>
                    <div class="flex flex-col">
                        <span class="leading-none">مدير المدرسة</span>
                        <span id="cloudStatus" class="text-[9px] mt-1"></span>
                    </div>
                </h1>
                <div class="flex gap-2 items-center">
                    <div class="bg-black/20 px-3 py-1.5 rounded-lg border border-white/10 backdrop-blur-sm flex items-center gap-2">
                        <i class="fas fa-clock text-sky-200 text-xs"></i>
                        <span id="currentTimeDisplay" class="font-mono font-bold text-green-300 dir-ltr text-sm"></span>
                    </div>
                    <button id="addHourBtn" class="text-xs bg-white/10 hover:bg-white/20 w-8 h-8 flex items-center justify-center rounded-lg transition text-sky-100 hover:text-white" title="تقديم ساعة">
                        <i class="fas fa-forward"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto p-4 md:p-6 pb-28">
            <div id="mainView" class="view active"></div>
            <div id="teachersView" class="view"></div>
            <div id="reportsView" class="view"></div>
            <div id="helpView" class="view"></div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-40 h-nav pb-safe">
            <div class="flex justify-around items-stretch h-full px-2">
                <button data-view="mainView" class="nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-1 transition-all duration-300 group text-blue-600">
                    <div class="w-12 h-8 flex items-center justify-center rounded-xl bg-blue-50 transition-colors">
                        <i class="fas fa-chalkboard text-xl mb-0.5"></i>
                    </div>
                    <span class="text-[10px] font-bold">الحصص</span>
                </button>
                <button data-view="teachersView" class="nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-1 transition-all duration-300 group text-slate-400 hover:text-slate-600">
                    <div class="w-12 h-8 flex items-center justify-center rounded-xl bg-transparent group-hover:bg-slate-50 transition-colors">
                        <i class="fas fa-users-cog text-xl mb-0.5"></i>
                    </div>
                    <span class="text-[10px] font-bold">المعلمين</span>
                </button>
                 <button data-view="reportsView" class="nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-1 transition-all duration-300 group text-slate-400 hover:text-slate-600">
                    <div class="w-12 h-8 flex items-center justify-center rounded-xl bg-transparent group-hover:bg-slate-50 transition-colors">
                        <i class="fas fa-file-invoice text-xl mb-0.5"></i>
                    </div>
                    <span class="text-[10px] font-bold">التقارير</span>
                </button>
                <button data-view="helpView" class="nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-1 transition-all duration-300 group text-slate-400 hover:text-slate-600">
                    <div class="w-12 h-8 flex items-center justify-center rounded-xl bg-transparent group-hover:bg-slate-50 transition-colors">
                        <i class="fas fa-question-circle text-xl mb-0.5"></i>
                    </div>
                    <span class="text-[10px] font-bold">التعليمات</span>
                </button>
                <button data-view="settingsView" class="nav-btn flex-1 flex flex-col items-center justify-center gap-1 py-1 transition-all duration-300 group text-slate-400 hover:text-slate-600">
                    <div class="w-12 h-8 flex items-center justify-center rounded-xl bg-transparent group-hover:bg-slate-50 transition-colors">
                        <i class="fas fa-cog text-xl mb-0.5"></i>
                    </div>
                    <span class="text-[10px] font-bold">الإعدادات</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Modals Container -->
    <div id="modalContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = {
                // --- STATE ---
                state: {
                    teachers: [],
                    periods: [],
                    classes: {},
                    violationTypes: [
                        { id: 'late', label: 'تأخر عن الحصة', points: 5, icon: 'fa-clock' },
                        { id: 'absent', label: 'غياب عن الحصة', points: 15, icon: 'fa-user-slash' },
                        { id: 'phone', label: 'استخدام الهاتف', points: 3, icon: 'fa-mobile-alt' }
                    ],
                    supervisionHistory: [],
                    evaluationDB: [],
                    cloudStatus: 'offline',
                    currentTime: new Date(),
                    simulationOffset: 0,
                    currentView: 'mainView',
                    db: null,
                    auth: null,
                    user: null
                },

                // --- INITIALIZATION ---
                init() {
                    this.initFirebase();
                    this.attachEventListeners();
                    this.startClock();
                },

                initFirebase() {
                    const firebaseConfig = {
                        apiKey: "AIzaSyC4NddjijF29YNhowy4SqgRaMPn01oSSEg",
                        authDomain: "school-9416e.firebaseapp.com",
                        projectId: "school-9416e",
                        storageBucket: "school-9416e.firebasestorage.app",
                        messagingSenderId: "680872052240",
                        appId: "1:680872052240:web:96d2e544166ab5f8096c95"
                    };

                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    this.state.db = firebase.firestore();
                    this.state.auth = firebase.auth();
                    this.updateCloudStatus('connected');

                    this.state.auth.onAuthStateChanged(user => {
                        if (user) {
                            this.state.user = user;
                            document.getElementById('loginView').classList.remove('active');
                            document.getElementById('appWrapper').classList.remove('hidden');
                            this.loadFromCloud();
                        } else {
                            this.state.user = null;
                            document.getElementById('loginView').classList.add('active');
                            document.getElementById('appWrapper').classList.add('hidden');
                        }
                    });
                },

                // --- AUTHENTICATION ---
                loginWithGoogle() {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    this.state.auth.signInWithPopup(provider)
                        .catch(error => {
                            console.error("Google sign-in error", error);
                            alert(`خطأ في تسجيل الدخول: ${error.message}`);
                        });
                },

                loginAsGuest() {
                    this.state.auth.signInAnonymously()
                        .catch(error => {
                            console.error("Guest sign-in error", error);
                            alert(`خطأ في تسجيل الدخول كضيف: ${error.message}`);
                        });
                },

                logout() {
                    this.state.auth.signOut();
                },

                // --- EVENT LISTENERS ---
                attachEventListeners() {
                    document.getElementById('googleLoginBtn').addEventListener('click', () => this.loginWithGoogle());
                    document.getElementById('guestLoginBtn').addEventListener('click', () => this.loginAsGuest());
                    document.getElementById('addHourBtn').addEventListener('click', () => this.addSimulationHour());
                    
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const viewId = e.currentTarget.dataset.view;
                            if (viewId === 'settingsView') {
                                this.renderSettingsModal();
                            } else {
                                this.setView(viewId);
                            }
                        });
                    });
                },

                // --- CLOCK & TIME ---
                startClock() {
                    setInterval(() => {
                        this.state.currentTime = new Date(new Date().getTime() + this.state.simulationOffset);
                        this.updateTimeDisplay();
                        if (this.state.currentView === 'mainView') {
                           this.renderCurrentClasses(); // Re-render to update current period
                        }
                    }, 1000);
                },

                updateTimeDisplay() {
                    const timeEl = document.getElementById('currentTimeDisplay');
                    if(timeEl) {
                        timeEl.textContent = this.state.currentTime.toLocaleTimeString('en-US', { hour12: false });
                    }
                },
                
                addSimulationHour() {
                    this.state.simulationOffset += 3600000;
                    this.state.currentTime = new Date(new Date().getTime() + this.state.simulationOffset);
                    this.renderCurrentClasses();
                },

                // --- DATA SYNC ---
                async loadFromCloud() {
                    if (!this.state.db) return;
                    try {
                        const doc = await this.state.db.collection("school_settings").doc("timetable").get();
                        if (doc.exists) {
                            const data = doc.data();
                            this.state.teachers = data.teachers || [];
                            this.state.periods = data.periods || [];
                            this.state.classes = data.classes || {};
                            if (data.violationTypes) this.state.violationTypes = data.violationTypes;
                            if (data.supervisionHistory) this.state.supervisionHistory = data.supervisionHistory;
                            if (data.evaluationDB) this.state.evaluationDB = data.evaluationDB;
                        }
                        this.updateCloudStatus('connected');
                        this.renderAllViews();
                    } catch (e) {
                        console.error("Load error", e);
                        this.updateCloudStatus('error');
                    }
                },
                
                async syncToCloud() {
                    if (!this.state.db) return;
                    this.updateCloudStatus('saving');
                    try {
                        await this.state.db.collection("school_settings").doc("timetable").set({
                            teachers: this.state.teachers,
                            periods: this.state.periods,
                            classes: this.state.classes,
                            violationTypes: this.state.violationTypes,
                            supervisionHistory: this.state.supervisionHistory,
                            evaluationDB: this.state.evaluationDB,
                        });
                        this.updateCloudStatus('connected');
                    } catch (e) {
                        console.error("Sync error", e);
                        this.updateCloudStatus('error');
                    }
                },

                updateCloudStatus(status) {
                    this.state.cloudStatus = status;
                    const statusEl = document.getElementById('cloudStatus');
                    if(!statusEl) return;
                    
                    let html = '';
                    switch (status) {
                        case 'connected':
                            html = `<span class="text-[9px] mt-1 bg-green-500/20 text-green-300 px-1.5 py-0.5 rounded-full border border-green-500/30 w-fit flex items-center gap-1"><i class="fas fa-circle text-[5px] animate-pulse"></i> متصل</span>`;
                            break;
                        case 'saving':
                             html = `<span class="text-[9px] mt-1 bg-amber-500/20 text-amber-300 px-1.5 py-0.5 rounded-full border border-amber-500/30 w-fit flex items-center gap-1"><i class="fas fa-sync fa-spin text-[6px]"></i> حفظ...</span>`;
                            break;
                        case 'error':
                        case 'offline':
                             html = `<span class="text-[9px] mt-1 bg-red-500/20 text-red-300 px-1.5 py-0.5 rounded-full border border-red-500/30 w-fit flex items-center gap-1"><i class="fas fa-wifi-slash"></i> غير متصل</span>`;
                            break;
                    }
                    statusEl.innerHTML = html;
                },

                // --- COMPUTED STATE ---
                getCurrentPeriod() {
                    const now = this.state.currentTime;
                    const mins = now.getHours() * 60 + now.getMinutes();
                    return this.state.periods.find(p => {
                        const [sh, sm] = p.start.split(':').map(Number);
                        const [eh, em] = p.end.split(':').map(Number);
                        return mins >= (sh * 60 + sm) && mins <= (eh * 60 + em);
                    });
                },

                getActiveLessons() {
                    const p = this.getCurrentPeriod();
                    const d = this.state.currentTime.getDay() + 1;
                    if (!p) return [];

                    const pId = parseInt(p.id);
                    const active = [];

                    this.state.teachers.forEach(t => {
                        const l = t.lessons.find(ls => ls.day === d && ls.period === pId);
                        if (l) {
                            active.push({ teacher: t, className: l.className });
                        }
                    });

                    return active.sort((a,b) => a.className.localeCompare(b.className, 'ar'));
                },
                
                // --- VIEW RENDERING ---
                setView(viewId) {
                    this.state.currentView = viewId;
                    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                    document.getElementById(viewId)?.classList.add('active');

                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if (btn.dataset.view === viewId) {
                            btn.classList.remove('text-slate-400', 'hover:text-slate-600');
                            btn.classList.add('text-blue-600');
                            btn.querySelector('div').classList.add('bg-blue-50');
                            btn.querySelector('div').classList.remove('bg-transparent', 'group-hover:bg-slate-50');
                        } else {
                            btn.classList.add('text-slate-400', 'hover:text-slate-600');
                            btn.classList.remove('text-blue-600');
                            btn.querySelector('div').classList.remove('bg-blue-50');
                             btn.querySelector('div').classList.add('bg-transparent', 'group-hover:bg-slate-50');
                        }
                    });
                    
                    this.renderAllViews();
                },
                
                renderAllViews() {
                    this.renderCurrentClasses();
                    this.renderTeachers();
                    this.renderReports();
                    this.renderHelp();
                },

                renderCurrentClasses() {
                    const container = document.getElementById('mainView');
                    if (!container) return;
                    
                    const period = this.getCurrentPeriod();
                    const lessons = this.getActiveLessons();

                    const periodHtml = period ? `
                        <div class="flex items-center gap-3 bg-blue-50 px-4 py-2 rounded-lg border border-blue-100 shadow-sm">
                            <span class="text-blue-900 font-bold">الحصة ${period.id}</span>
                            <span class="text-blue-300">|</span>
                            <span class="text-blue-600 font-mono text-sm">${period.start} - ${period.end}</span>
                        </div>
                    ` : `
                        <div class="bg-amber-50 text-amber-700 px-4 py-2 rounded-lg border border-amber-100 font-bold text-sm">
                            لا توجد حصص نشطة
                        </div>
                    `;

                    const lessonsHtml = lessons.length > 0 ? lessons.map(item => `
                        <div class="group bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300 border border-slate-200 overflow-hidden relative flex flex-col">
                            <div class="h-1 w-full bg-blue-500"></div>
                            <div class="p-2 flex-1 flex flex-col">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="bg-slate-100 text-slate-800 px-2 py-0.5 rounded text-xs font-bold border border-slate-200 truncate max-w-[70%]">${item.className}</span>
                                    <div class="w-5 h-5 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-[9px] font-bold border border-blue-100">${item.teacher.short ? item.teacher.short[0] : '?'}</div>
                                </div>
                                <h3 class="font-bold text-xs text-slate-700 mb-1 truncate" title="${item.teacher.name}">${item.teacher.name}</h3>
                                <div class="flex items-center gap-1 text-[9px] text-slate-400 mb-2">
                                    <i class="fas fa-star text-yellow-400"></i> 
                                    <span>${item.teacher.score}%</span>
                                </div>
                                <button data-teacher-id="${item.teacher.id}" data-class-name="${item.className}" class="action-btn mt-auto w-full py-1 rounded bg-blue-50 hover:bg-blue-100 text-blue-700 font-bold text-[10px] transition-colors flex justify-center items-center gap-1">
                                    <i class="fas fa-cog"></i> إجراء
                                </button>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="col-span-full py-16 text-center text-slate-400 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200">
                            <i class="fas fa-coffee text-3xl mb-3 text-slate-300"></i>
                            <p class="text-sm">لا توجد حصص في الوقت الحالي</p>
                        </div>
                    `;

                    container.innerHTML = `
                        <div class="space-y-4">
                          <div class="flex flex-col md:flex-row justify-between items-center gap-3 bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-100 text-blue-700 w-10 h-10 rounded-full flex items-center justify-center text-lg"><i class="fas fa-clock"></i></div>
                                <div><h2 class="text-xl font-bold text-slate-800">الحصص القائمة الآن</h2></div>
                            </div>
                            ${periodHtml}
                          </div>
                          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2">
                            ${lessonsHtml}
                          </div>
                        </div>
                    `;

                    container.querySelectorAll('.action-btn').forEach(btn => btn.addEventListener('click', e => {
                        const teacherId = e.currentTarget.dataset.teacherId;
                        const className = e.currentTarget.dataset.className;
                        this.renderActionModal(teacherId, className);
                    }));
                },

                renderTeachers(searchTerm = '') {
                    const container = document.getElementById('teachersView');
                    if (!container) return;
                    
                    const term = searchTerm.toLowerCase();
                    const teachers = this.state.teachers
                        .filter(t => t.name.toLowerCase().includes(term))
                        .sort((a, b) => a.name.localeCompare(b.name, 'ar'));

                    const teachersHtml = teachers.length > 0 ? teachers.map(t => {
                        let scoreClass = "bg-red-50 text-red-600 border border-red-100";
                        if (t.score >= 90) scoreClass = "bg-emerald-50 text-emerald-600 border border-emerald-100";
                        else if (t.score >= 70) scoreClass = "bg-yellow-50 text-yellow-600 border border-yellow-100";

                        return `
                            <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 p-5 flex flex-col gap-4">
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-sky-500 to-blue-600 text-white flex items-center justify-center font-bold shadow-sm">${t.short ? t.short[0] : '?'}</div>
                                        <div>
                                            <h3 class="font-bold text-slate-800 line-clamp-1">${t.name}</h3>
                                            <span class="text-xs text-slate-500">${t.short}</span>
                                        </div>
                                    </div>
                                    <div class="font-bold text-sm px-2 py-1 rounded-md ${scoreClass}">${t.score}%</div>
                                </div>
                                <div class="relative group/input">
                                    <i class="fas fa-phone absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within/input:text-blue-500 transition-colors"></i>
                                    <input type="tel" value="${t.phone || ''}" onchange="app.updateTeacherPhone('${t.id}', event.target.value)" placeholder="أضف رقم الهاتف" class="w-full pr-9 pl-3 py-2 text-sm rounded-lg border border-slate-200 bg-slate-50 focus:bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all dir-rtl">
                                </div>
                                <div class="flex gap-2 mt-auto pt-2 border-t border-slate-50">
                                    <button data-teacher-id="${t.id}" class="action-btn flex-1 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 py-2 rounded-lg text-xs font-bold transition">خيارات</button>
                                    <button onclick="app.openWhatsApp('${t.id}')" class="w-10 flex items-center justify-center bg-green-50 hover:bg-green-100 text-green-600 border border-green-200 rounded-lg transition"><i class="fab fa-whatsapp"></i></button>
                                </div>
                            </div>
                        `;
                    }).join('') : `<div class="col-span-full py-12 text-center text-slate-400">لا توجد نتائج مطابقة للبحث</div>`;

                    container.innerHTML = `
                        <div class="space-y-6">
                            <div class="flex flex-col md:flex-row justify-between gap-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <div><h2 class="text-2xl font-bold text-slate-800">سجل المعلمين</h2><p class="text-slate-500 text-sm">إدارة بيانات التواصل والتقييمات</p></div>
                                <div class="relative w-full md:w-96">
                                    <input type="text" placeholder="بحث عن معلم..." oninput="app.renderTeachers(this.value)" class="w-full pl-4 pr-10 py-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none bg-slate-50 focus:bg-white">
                                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5">${teachersHtml}</div>
                        </div>
                    `;

                     container.querySelectorAll('.action-btn').forEach(btn => btn.addEventListener('click', e => {
                        const teacherId = e.currentTarget.dataset.teacherId;
                        this.renderActionModal(teacherId);
                    }));
                },
                
                renderReports() {
                    const container = document.getElementById('reportsView');
                    if (!container) return;
                    
                    const teachersHtml = this.state.teachers.map(t => {
                       let scoreBadge = "bg-red-100 text-red-700";
                        if (t.score >= 90) scoreBadge = "bg-green-100 text-green-700";
                        else if (t.score >= 70) scoreBadge = "bg-yellow-100 text-yellow-700";

                        return `
                        <tr class="hover:bg-slate-50/50 transition-colors group">
                            <td class="p-5 font-semibold text-slate-700">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded bg-blue-50 text-blue-600 flex items-center justify-center text-xs font-bold">${t.short[0]}</div>
                                    ${t.name}
                                </div>
                            </td>
                            <td class="p-5 text-center"><span class="inline-block px-3 py-1 rounded-full text-xs font-bold ${scoreBadge}">${t.score}%</span></td>
                            <td class="p-5 text-center text-slate-500 font-mono text-sm">${t.phone || '-'}</td>
                            <td class="p-5 text-center">
                                ${t.score < 80 ? '<span class="text-xs text-red-500 font-bold bg-red-50 px-2 py-1 rounded">يحتاج متابعة</span>' : '<span class="text-xs text-green-500 font-bold bg-green-50 px-2 py-1 rounded">ممتاز</span>'}
                            </td>
                        </tr>
                        `;
                    }).join('');

                    container.innerHTML = `
                         <div class="space-y-6">
                            <div class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <div><h2 class="text-2xl font-bold text-slate-800">تقارير الأداء</h2><p class="text-sm text-slate-500">نظرة عامة على انضباط المعلمين</p></div>
                                <button onclick="app.exportToExcel()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2.5 rounded-xl font-bold flex items-center gap-2 transition shadow-lg shadow-emerald-200">
                                    <i class="fas fa-file-excel"></i><span>تصدير Excel</span>
                                </button>
                            </div>
                            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                <div class="overflow-x-auto">
                                    <table class="w-full text-right">
                                        <thead class="bg-slate-50 border-b border-slate-100 text-slate-500 text-sm uppercase">
                                            <tr>
                                                <th class="p-5 font-bold">المعلم</th>
                                                <th class="p-5 font-bold text-center">التقييم</th>
                                                <th class="p-5 font-bold text-center">الهاتف</th>
                                                <th class="p-5 font-bold text-center">الحالة</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-50">${teachersHtml}</tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                },

                renderHelp() {
                    const container = document.getElementById('helpView');
                    if (!container) return;
                    container.innerHTML = `
                        <div class="space-y-8">
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-center">
                                <i class="fas fa-info-circle text-5xl text-blue-500 mb-4"></i>
                                <h2 class="text-2xl font-bold text-slate-800">مركز التعليمات والمساعدة</h2>
                                <p class="text-slate-500 text-sm mt-1">دليل شامل لاستخدام نظام مدير المدرسة الذكي</p>
                            </div>

                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 space-y-6">
                                <h3 class="text-xl font-bold text-slate-800 border-b pb-3 mb-4 flex items-center gap-3"><i class="fas fa-file-import text-blue-500"></i>استيراد البيانات</h3>
                                
                                <!-- Step 1: Schedule -->
                                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                    <h4 class="font-bold text-slate-700 mb-2">1. استيراد الجدول المدرسي (ملف XML)</h4>
                                    <p class="text-sm text-slate-600 mb-3">يجب استيراد جدول الحصص أولاً. النظام يقبل ملفات XML المصدرة من برنامج الجداول المدرسية aSc Timetables.</p>
                                    <p class="text-sm text-slate-600">اذهب إلى <button onclick="app.renderSettingsModal()" class="font-bold text-blue-600 hover:underline">الإعدادات</button> ثم اضغط على زر "رفع ملف XML".</p>
                                </div>

                                <!-- Step 2: Teacher Data -->
                                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                    <h4 class="font-bold text-slate-700 mb-2">2. استيراد بيانات المعلمين وأرقام هواتفهم (ملف Excel)</h4>
                                    <p class="text-sm text-slate-600 mb-3">لتتمكن من استخدام ميزات التواصل عبر الواتساب، يجب استيراد أرقام هواتف المعلمين. يمكنك القيام بذلك دفعة واحدة عبر ملف Excel.</p>
                                    <div class="space-y-2">
                                        <p class="text-sm text-slate-600"><strong class="text-slate-800">الخطوة الأولى:</strong> قم بتحميل القالب الجاهز من الزر أدناه.</p>
                                        <button onclick="app.exportTeacherDataTemplate()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-bold text-xs transition inline-flex items-center gap-2">
                                            <i class="fas fa-download"></i> تحميل قالب بيانات المعلمين
                                        </button>
                                        <p class="text-sm text-slate-600 mt-2"><strong class="text-slate-800">الخطوة الثانية:</strong> افتح الملف واملأ بيانات المعلمين. تأكد من تطابق عمود <code class="bg-slate-200 text-red-600 text-xs p-1 rounded">id</code> مع أرقام المعلمين التعريفية في برنامج الجداول.</p>
                                        <p class="text-sm text-slate-600"><strong class="text-slate-800">الخطوة الثالثة:</strong> اذهب إلى <button onclick="app.renderSettingsModal()" class="font-bold text-blue-600 hover:underline">الإعدادات</button> واضغط على زر "استيراد" تحت قسم بيانات المعلمين لرفع الملف الذي قمت بتعبئته.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                },

                // --- MODALS ---
                closeModal() {
                    const modal = document.getElementById('modalContainer');
                    if (modal) modal.innerHTML = '';
                },

                renderActionModal(teacherId, className) {
                    const teacher = this.state.teachers.find(t => t.id === teacherId);
                    if (!teacher) return;
                    
                    const modalContainer = document.getElementById('modalContainer');
                    const violationHtml = this.state.violationTypes.map(v => `
                         <button onclick="app.dockScore('${teacher.id}', ${v.points}, '${v.label}')" class="w-full bg-slate-50 hover:bg-red-50 text-slate-700 hover:text-red-700 border border-slate-200 hover:border-red-200 p-3 rounded-lg flex items-center justify-between transition group">
                            <span class="flex items-center gap-3 font-bold text-sm">
                                <div class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 group-hover:text-red-500 group-hover:border-red-200 transition">
                                    <i class="fas ${v.icon}"></i>
                                </div>
                                ${v.label}
                            </span>
                            <span class="bg-white px-2 py-1 rounded text-xs font-bold text-red-500 border border-slate-200 group-hover:border-red-200 shadow-sm">-${v.points}</span>
                        </button>
                    `).join('');

                    modalContainer.innerHTML = `
                         <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                            <div class="modal-overlay absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="app.closeModal()"></div>
                            <div class="modal-content relative bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
                                <div class="bg-slate-800 p-4 text-white flex justify-between items-start">
                                    <div>
                                        <h3 class="text-lg font-bold flex items-center gap-2"><i class="fas fa-user-edit text-yellow-400"></i> ${teacher.name}</h3>
                                        ${className ? `<p class="text-slate-300 text-xs mt-1">الحصة الحالية: <span class="text-white font-bold">${className}</span></p>` : ''}
                                    </div>
                                    <button onclick="app.closeModal()" class="text-white/50 hover:text-white transition"><i class="fas fa-times text-lg"></i></button>
                                </div>
                                <div class="p-4 space-y-4 max-h-[70vh] overflow-y-auto custom-scrollbar">
                                    <div class="space-y-2">
                                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">التواصل</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <button onclick="app.sendWhatsApp('${teacher.id}', 'summon')" class="bg-emerald-50 hover:bg-emerald-100 text-emerald-700 border border-emerald-200 p-3 rounded-lg font-bold text-xs flex flex-col items-center gap-2 transition text-center">
                                                <i class="fab fa-whatsapp text-xl"></i><span>استدعاء</span>
                                            </button>
                                            <button ${!className ? 'disabled' : ''} onclick="app.sendWhatsApp('${teacher.id}', 'remind', '${className}')" class="bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 p-3 rounded-lg font-bold text-xs flex flex-col items-center gap-2 transition text-center disabled:opacity-50 disabled:cursor-not-allowed">
                                                <i class="fas fa-bell text-xl"></i><span>تذكير</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="h-px bg-slate-100"></div>
                                    <div class="space-y-2">
                                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">المخالفات والخصومات</label>
                                        <div class="space-y-2">${violationHtml}</div>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-3 text-center border-t border-slate-200 flex justify-between items-center px-6">
                                    <span class="text-xs text-slate-500">التقييم الحالي</span>
                                    <span class="text-lg font-bold text-slate-800">${teacher.score}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                },
                
                renderSettingsModal() {
                    this.closeModal(); // Close any other open modal
                    const modalContainer = document.getElementById('modalContainer');

                    modalContainer.innerHTML = `
                        <div class="fixed inset-0 z-[60] flex items-center justify-center p-4">
                            <div class="modal-overlay absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="app.closeModal()"></div>
                            <div class="modal-content relative bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                                <div class="bg-slate-800 text-white p-5 flex justify-between items-center shrink-0">
                                    <h3 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-cog"></i> الإعدادات</h3>
                                    <button onclick="app.closeModal()" class="text-white/70 hover:text-white transition"><i class="fas fa-times text-xl"></i></button>
                                </div>
                                <div class="p-6 overflow-y-auto custom-scrollbar space-y-8">
                                    <!-- Data Import -->
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                            <h4 class="font-bold text-blue-900 mb-2 flex items-center gap-2 text-sm"><i class="fas fa-calendar-alt"></i> جدول الحصص (XML)</h4>
                                            <button onclick="document.getElementById('xmlInput').click()" class="w-full bg-white hover:bg-blue-100 text-blue-700 border border-blue-200 py-2 rounded-lg font-bold text-xs transition">رفع ملف XML</button>
                                            <input type="file" id="xmlInput" accept=".xml" class="hidden" onchange="app.handleXmlUpload(event)">
                                        </div>
                                        <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100">
                                            <h4 class="font-bold text-emerald-900 mb-2 flex items-center gap-2 text-sm"><i class="fas fa-users"></i> بيانات المعلمين (Excel)</h4>
                                            <div class="flex gap-2">
                                                <button onclick="app.exportTeacherDataTemplate()" class="flex-1 bg-white border border-emerald-200 text-emerald-700 hover:bg-emerald-100 py-2 rounded-lg font-bold text-xs transition"><i class="fas fa-download"></i> تحميل القالب</button>
                                                <button onclick="document.getElementById('excelInput').click()" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded-lg font-bold text-xs transition"><i class="fas fa-upload"></i> استيراد</button>
                                            </div>
                                            <input type="file" id="excelInput" accept=".xlsx, .xls" class="hidden" onchange="app.handleExcelUpload(event)">
                                        </div>
                                    </div>
                                    <!-- Support Section -->
                                    <div class="bg-slate-100 p-4 rounded-xl border border-slate-200 text-center">
                                         <h4 class="font-bold text-slate-800 mb-2">الدعم الفني</h4>
                                         <p class="text-sm text-slate-600 mb-3">تصميم وبرمجة: عادل الغزيلي</p>
                                         <a href="https://wa.me/96598882855" target="_blank" class="inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm transition">
                                             <i class="fab fa-whatsapp"></i> تواصل عبر واتساب
                                         </a>
                                    </div>
                                     <button onclick="app.logout()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg">تسجيل الخروج</button>
                                </div>
                            </div>
                        </div>
                    `;
                },

                // --- ACTIONS ---
                async updateTeacherPhone(id, phone) {
                    const teacher = this.state.teachers.find(t => t.id === id);
                    if (teacher) {
                        teacher.phone = phone;
                        await this.syncToCloud();
                        alert('تم تحديث رقم الهاتف');
                    }
                },
                
                async dockScore(teacherId, points, reason) {
                    if (confirm(`تأكيد خصم ${points} نقاط بسبب: ${reason}؟`)) {
                        const teacher = this.state.teachers.find(t => t.id === teacherId);
                        if (teacher) {
                            teacher.score = Math.max(0, teacher.score - points);
                            await this.syncToCloud();
                            this.closeModal();
                            this.renderAllViews();
                        }
                    }
                },
                
                openWhatsApp(teacherId, type, className) {
                    const teacher = this.state.teachers.find(t => t.id === teacherId);
                    if (!teacher || !teacher.phone) {
                        alert('يرجى إضافة رقم الهاتف للمعلم أولاً');
                        return;
                    }
                    let msg = "";
                    if (type === 'summon') {
                        msg = `السلام عليكم أستاذ ${teacher.name}، يرجى التكرم بزيارة مكتب الإدارة في أقرب وقت.`;
                    } else if (type === 'remind') {
                        msg = `السلام عليكم أستاذ ${teacher.name}، تذكير بموعد حصتكم الحالية في الصف ${className || ''}.`;
                    } else {
                         // Default action for teacher list
                         window.open(`https://wa.me/${teacher.phone}`, '_blank');
                         return;
                    }
                    window.open(`https://wa.me/${teacher.phone}?text=${encodeURIComponent(msg)}`, '_blank');
                },
                
                sendWhatsApp(teacherId, type, className) {
                    this.openWhatsApp(teacherId, type, className);
                },

                // --- FILE HANDLING ---
                handleXmlUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(e.target.result, "text/xml");
                        
                        let teachers = [], periods = [], classes = {}, lessons = [];
                        
                        // Parse teachers, periods, classes from XML
                        xmlDoc.querySelectorAll('teacher').forEach(t => teachers.push({ id: t.getAttribute('id'), name: t.getAttribute('name'), short: t.getAttribute('shortname'), score: 100, phone: '', lessons: [] }));
                        xmlDoc.querySelectorAll('period').forEach(p => periods.push({ id: p.getAttribute('period'), start: p.getAttribute('starttime'), end: p.getAttribute('endtime') }));
                        xmlDoc.querySelectorAll('class').forEach(c => classes[c.getAttribute('id')] = c.getAttribute('name'));
                        
                        // Parse lessons and assign to teachers
                        xmlDoc.querySelectorAll('lesson').forEach(l => {
                            const teacherId = l.getAttribute('teacherids');
                            const classId = l.getAttribute('classids');
                            if(teacherId && classId) {
                                const teacher = teachers.find(t => t.id === teacherId);
                                if(teacher) {
                                     l.querySelectorAll('card').forEach(c => {
                                         teacher.lessons.push({
                                             day: parseInt(c.getAttribute('day')),
                                             period: parseInt(c.getAttribute('period')),
                                             className: classes[classId] || 'غير معروف'
                                         });
                                     });
                                }
                            }
                        });

                        this.state.teachers = teachers;
                        this.state.periods = periods.sort((a, b) => parseInt(a.id) - parseInt(b.id));
                        this.state.classes = classes;
                        this.syncToCloud().then(() => {
                             alert('تم استيراد الجدول بنجاح!');
                             this.loadFromCloud();
                        });
                        this.closeModal();
                    };
                    reader.readAsText(file);
                },

                handleExcelUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet);

                        if (json.length > 0 && 'id' in json[0] && 'phone' in json[0]) {
                            this.state.teachers.forEach(teacher => {
                                const match = json.find(row => String(row.id) === teacher.id);
                                if (match) {
                                    teacher.phone = String(match.phone || '');
                                    teacher.name = match.name || teacher.name;
                                    teacher.short = match.short || teacher.short;
                                }
                            });
                            this.syncToCloud().then(() => alert('تم تحديث بيانات المعلمين بنجاح!'));
                            this.closeModal();
                        } else {
                            alert('ملف Excel غير متوافق. يجب أن يحتوي على أعمدة id, name, short, phone.');
                        }
                    };
                    reader.readAsArrayBuffer(file);
                },

                exportTeacherDataTemplate() {
                    const data = [['id', 'name', 'short', 'phone']];
                     // Add current teachers as examples
                    this.state.teachers.slice(0, 3).forEach(t => {
                        data.push([t.id, t.name, t.short, t.phone]);
                    });

                    const ws = XLSX.utils.aoa_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Teachers');
                    XLSX.writeFile(wb, 'teacher_data_template.xlsx');
                },

                exportToExcel() {
                    const data = this.state.teachers.map(t => ({
                        'المعلم': t.name,
                        'الرمز': t.short,
                        'الهاتف': t.phone,
                        'التقييم': t.score
                    }));
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Teacher Reports');
                    XLSX.writeFile(wb, 'teacher_reports.xlsx');
                }
            };

            app.init();
            
            // For debugging
            window.app = app;
        });
    </script>
</body>
</html>
