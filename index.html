function refresh() {
    const now = new Date();
    const d = isSim ? sDay : (now.getDay() === 0 ? 1 : now.getDay() + 1);
    const t = isSim ? sTime : now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
    document.getElementById('infoDate').innerText = t;
    
    const p = (data.periods || []).find(p => { 
        const cur = toM(t), s = toM(p.s), e = toM(p.e); 
        return cur >= s && cur <= e; 
    });

    const list = document.getElementById('lessons-list');
    if (p && data.lessons) {
        document.getElementById('infoPeriod').innerText = "Ø§Ù„Ø­ØµØ© Ø§Ù„Ù†Ø´Ø·Ø©: " + p.id;
        
        // 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø­ØµØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let current = data.lessons.filter(l => l.d == d && l.p == p.id);

        // 2. Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£ØµØºØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£ÙƒØ¨Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ØµÙ
        current.sort((a, b) => {
            const nameA = (data.classes[a.c] || '').toString();
            const nameB = (data.classes[b.c] || '').toString();
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… localeCompare Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø±Ù‚Ù…ÙŠØ© Ù„ØªØ±ØªÙŠØ¨ (1/1 Ù‚Ø¨Ù„ 2/1 ÙˆÙ‡ÙƒØ°Ø§)
            return nameA.localeCompare(nameB, undefined, {numeric: true, sensitivity: 'base'});
        });

        // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø©
        list.innerHTML = current.map(l => {
            let n = data.teachers[l.t], 
                ph = (phones[n] || "").replace(/\s+/g, ''), 
                className = data.classes[l.c] || '..';
            return `
                <div class="lesson-card">
                    <div class="class-badge">${className}</div>
                    <div style="flex:1; padding-right:15px;">
                        <b>${n}</b><br>
                        <small>${data.subjects[l.s] || ''}</small>
                    </div>
                    <button onclick="window.open('https://wa.me/${ph}?text=Ù†Ù„Ø§Ø­Ø¸ ØªØ£Ø®Ø±ÙƒÙ…')" 
                            style="border:none; background:#10b981; color:white; width:35px; height:35px; border-radius:50%;">ðŸ’¬</button>
                </div>`;
        }).join('');
    } else {
        document.getElementById('infoPeriod').innerText = "Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¯ÙˆØ§Ù…";
        list.innerHTML = `<div style="text-align:center; padding:50px; color:#94a3b8;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
    }
}
