<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø§Ø¦Ø¯ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --primary: #0f172a; --accent: #f59e0b; --bg: #f8fafc; --card: #ffffff;
            --blue-grad: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
        }

        * { font-family: 'Tajawal', sans-serif !important; box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: #1e293b; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 25px;
            text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px;
        }
        .google-btn {
            width: 100%; padding: 15px; background: white; border: 2px solid #e2e8f0;
            border-radius: 12px; cursor: pointer; font-weight: bold; display: flex; 
            align-items: center; justify-content: center; gap: 10px; font-size: 16px;
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        #app-interface { display: none; }
        .header { background: var(--blue-grad); color: white; padding: 20px; border-radius: 0 0 25px 25px; }
        .container { padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .action-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h1 style="margin-bottom:10px;">Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø§Ø¦Ø¯ âš¡</h1>
            <p style="color:#64748b; margin-bottom:25px;">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            <button id="authBtn" onclick="handleLogin()" class="google-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                <span>Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„</span>
            </button>
            <div id="statusMsg" style="margin-top:15px; font-size:12px; color: #ef4444;"></div>
        </div>
    </div>

    <div id="app-interface">
        <div class="header">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div id="userEmail" style="font-size:12px; opacity:0.8;"></div>
                    <h2 style="font-size:18px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                </div>
                <button onclick="handleLogout()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:8px 15px; border-radius:8px; cursor:pointer;">Ø®Ø±ÙˆØ¬ ğŸšª</button>
            </div>
        </div>

        <div class="container">
            <div class="card">
                <h3>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©</h3>
                <p style="margin-top:10px; color:#64748b;">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª.</p>
            </div>
            </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyC4NddjijF29YNhowy4SqgRaMPn01oSSEg",
            authDomain: "school-9416e.firebaseapp.com",
            projectId: "school-9416e",
            storageBucket: "school-9416e.appspot.com",
            messagingSenderId: "680872052240",
            appId: "1:680872052240:web:96d2e544166ab5f8096c95"
        };

        // ØªØ´ØºÙŠÙ„ Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();

        // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log("Logged in:", user.email);
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-interface').style.display = 'block';
                document.getElementById('userEmail').innerText = "ğŸ‘¤ " + user.email;
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-interface').style.display = 'none';
            }
        });

        // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØªØ§Ø¦Ø¬ "Redirect" Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                console.log("Redirect success");
            }
        }).catch((error) => {
            console.error("Redirect error:", error);
            document.getElementById('statusMsg').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message;
        });

        // 3. ÙˆØ¸ÙŠÙØ© Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ø³ØªØ®Ø¯Ø§Ù… Redirect)
        function handleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            document.getElementById('authBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...";
            // Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø³ØªÙ‚ÙˆÙ… Ø¨ÙØªØ­ ØµÙØ­Ø© Ø¬ÙˆØ¬Ù„ ÙÙŠ Ù†ÙØ³ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù„ØªØ¬Ù†Ø¨ Ø­Ø¸Ø± Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            auth.signInWithRedirect(provider);
        }

        // 4. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function handleLogout() {
            auth.signOut().then(() => {
                location.reload();
            });
        }
    </script>
</body>
</html>
