<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة القائد - نظام الإدارة المتكامل</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Manifest for PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader">
            <div class="spinner"></div>
            <p>جاري تحميل المنصة...</p>
        </div>
    </div>
    
    <!-- Firebase Auth Screen -->
    <div id="firebase-auth-screen"></div>
    
    <!-- Main App (Hidden Initially) -->
    <div id="app-container" style="display: none;">
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-top">
                <button class="menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <h1>منصة القائد</h1>
                </div>
                <div class="user-info">
                    <span id="welcome-message">مرحباً</span>
                    <button class="logout-btn" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            
            <!-- Current Time and Status -->
            <div class="header-status">
                <div class="time-display" id="current-time">
                    <i class="fas fa-clock"></i>
                    <span>--:--</span>
                </div>
                <div class="period-display" id="current-period">
                    <i class="fas fa-calendar-alt"></i>
                    <span>جاري التحميل...</span>
                </div>
                <div class="sync-status" id="sync-status">
                    <i class="fas fa-cloud"></i>
                    <span>غير متصل</span>
                </div>
            </div>
        </header>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" onclick="switchView('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>لوحة القيادة</span>
                </a>
                <a href="#schedule" class="nav-item" onclick="switchView('schedule')">
                    <i class="fas fa-calendar-day"></i>
                    <span>الجداول</span>
                </a>
                <a href="#teachers" class="nav-item" onclick="switchView('teachers')">
                    <i class="fas fa-users"></i>
                    <span>المعلمين</span>
                </a>
                <a href="#visits" class="nav-item" onclick="switchView('visits')">
                    <i class="fas fa-eye"></i>
                    <span>الزيارات</span>
                </a>
                <a href="#tasks" class="nav-item" onclick="switchView('tasks')">
                    <i class="fas fa-tasks"></i>
                    <span>المهام</span>
                </a>
                <a href="#reports" class="nav-item" onclick="switchView('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>التقارير</span>
                </a>
                <a href="#settings" class="nav-item" onclick="switchView('settings')">
                    <i class="fas fa-cog"></i>
                    <span>الإعدادات</span>
                </a>
            </nav>
            
            <!-- Sync Button -->
            <div class="sidebar-footer">
                <button class="sync-btn" onclick="manualSync()">
                    <i class="fas fa-sync-alt"></i>
                    <span>مزامنة الآن</span>
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Dashboard View -->
            <div id="view-dashboard" class="view active">
                <div class="view-header">
                    <h2><i class="fas fa-tachometer-alt"></i> لوحة القيادة</h2>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="refreshData()">
                            <i class="fas fa-redo"></i> تحديث
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #3b82f6;">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-teachers">0</h3>
                            <p>معلم</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #10b981;">
                            <i class="fas fa-school"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-classes">0</h3>
                            <p>صف دراسي</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #f59e0b;">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="active-lessons">0</h3>
                            <p>حصة نشطة</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #ef4444;">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pending-tasks">0</h3>
                            <p>مهمة معلقة</p>
                        </div>
                    </div>
                </div>
                
                <!-- Current Schedule -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-clock"></i> الجدول الحالي</h3>
                        <button class="btn btn-sm" onclick="simulateRandomPeriod()">
                            <i class="fas fa-dice"></i> محاكاة
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="current-schedule-table">
                            <p class="text-muted">جاري تحميل الجدول...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-bolt"></i> إجراءات سريعة</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions">
                            <button class="action-btn" onclick="openUploadModal()">
                                <i class="fas fa-file-upload"></i>
                                <span>رفع جدول</span>
                            </button>
                            <button class="action-btn" onclick="openNewVisitModal()">
                                <i class="fas fa-eye"></i>
                                <span>زيارة جديدة</span>
                            </button>
                            <button class="action-btn" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i>
                                <span>تصدير بيانات</span>
                            </button>
                            <button class="action-btn" onclick="generateReport()">
                                <i class="fas fa-chart-pie"></i>
                                <span>تقرير سريع</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Schedule View -->
            <div id="view-schedule" class="view">
                <div class="view-header">
                    <h2><i class="fas fa-calendar-day"></i> الجدول المدرسي</h2>
                    <div class="view-actions">
                        <select id="day-filter" class="form-control" onchange="filterByDay()" style="width: auto;">
                            <option value="all">كل الأيام</option>
                            <option value="1">الأحد</option>
                            <option value="2">الإثنين</option>
                            <option value="3">الثلاثاء</option>
                            <option value="4">الأربعاء</option>
                            <option value="5">الخميس</option>
                        </select>
                    </div>
                </div>
                
                <!-- Schedule Controls -->
                <div class="card">
                    <div class="card-body">
                        <div class="schedule-controls">
                            <button class="btn btn-primary" onclick="openUploadModal()">
                                <i class="fas fa-upload"></i> رفع ملف XML
                            </button>
                            <button class="btn btn-secondary" onclick="exportSchedule()">
                                <i class="fas fa-download"></i> تصدير الجدول
                            </button>
                            <button class="btn btn-warning" onclick="clearSchedule()">
                                <i class="fas fa-trash"></i> مسح الجدول
                            </button>
                        </div>
                        
                        <!-- Schedule Table -->
                        <div id="schedule-table-container">
                            <div class="empty-state">
                                <i class="fas fa-calendar-plus"></i>
                                <h3>لا يوجد جدول مدرسي</h3>
                                <p>ابدأ برفع ملف الجدول (XML) لمشاهدة الجدول</p>
                                <button class="btn btn-primary" onclick="openUploadModal()">
                                    <i class="fas fa-upload"></i> رفع جدول الآن
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Teachers View -->
            <div id="view-teachers" class="view">
                <div class="view-header">
                    <h2><i class="fas fa-users"></i> إدارة المعلمين</h2>
                    <div class="view-actions">
                        <button class="btn btn-primary" onclick="openTeacherModal()">
                            <i class="fas fa-plus"></i> إضافة معلم
                        </button>
                    </div>
                </div>
                
                <!-- Teachers Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="teacher-search" placeholder="ابحث عن معلم..." 
                                   onkeyup="searchTeachers()">
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="teachers-table">
                                <thead>
                                    <tr>
                                        <th>اسم المعلم</th>
                                        <th>رقم الهاتف</th>
                                        <th>عدد الحصص</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="teachers-table-body">
                                    <tr>
                                        <td colspan="4" class="text-center">
                                            <p class="text-muted">لا يوجد معلمين مضافين</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Visits View -->
            <div id="view-visits" class="view">
                <!-- Content for visits -->
            </div>
            
            <!-- Tasks View -->
            <div id="view-tasks" class="view">
                <!-- Content for tasks -->
            </div>
            
            <!-- Reports View -->
            <div id="view-reports" class="view">
                <!-- Content for reports -->
            </div>
            
            <!-- Settings View -->
            <div id="view-settings" class="view">
                <!-- Content for settings -->
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="app-footer">
            <p>منصة القائد &copy; 2026 - نظام الإدارة المتكامل للمدارس</p>
            <div class="footer-links">
                <span id="connection-status">غير متصل</span>
                <span id="data-size">0 KB</span>
            </div>
        </footer>
    </div>
    
    <!-- Modals -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-upload"></i> رفع ملف الجدول</h3>
                <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>اختر ملف الجدول المدرسي (XML) الذي تم تصديره من نظام الإدارة المدرسية</p>
                <div class="file-upload-area" onclick="document.getElementById('xml-file-input').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>انقر لاختيار ملف أو اسحبه هنا</p>
                    <span>الملفات المدعومة: XML</span>
                </div>
                <input type="file" id="xml-file-input" accept=".xml" style="display: none;" onchange="handleXMLUpload(this)">
                
                <div class="upload-progress" style="display: none;" id="upload-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span id="progress-text">0%</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeUploadModal()">إلغاء</button>
                <button class="btn btn-primary" onclick="processXMLUpload()" disabled id="process-btn">
                    معالجة الملف
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notifications Container -->
    <div id="notifications-container"></div>
    
    <!-- Firebase SDK (ES Modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC4NddjijF29YNhowy4SqgRaMPn01oSSEg",
            authDomain: "school-9416e.firebaseapp.com",
            projectId: "school-9416e",
            storageBucket: "school-9416e.firebasestorage.app",
            messagingSenderId: "680872052240",
            appId: "1:680872052240:web:96d2e544166ab5f8096c95",
            measurementId: "G-5EBTV0MV83",
            databaseURL: "https://school-9416e-default-rtdb.firebaseio.com"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        
        console.log("✅ Firebase initialized");
    </script>
    
    <!-- App Scripts -->
    <script src="js/app.js" defer></script>
    <script src="js/schedule.js" defer></script>
    
    <!-- Firebase Scripts -->
    <script src="firebase/firebase-service.js" defer></script>
    <script src="firebase/firebase-ui.js" defer></script>
    <script src="firebase/firebase-helpers.js" defer></script>
</body>
</html>
